@{
    ViewBag.Title = "Sala 5 - Wordle";
    var historial = ViewBag.HistorialWordle as List<salaEscape.Models.JugadaWordle>;
    int wordleActual = ViewBag.wordleActual ?? 1;
    bool finalizado = ViewBag.finalizado ?? false;
    int cantLetras = ViewBag.cantLetras ?? 0;
    string fondo = $"/images/fondoSala5{wordleActual - 1}.png";
}
<body style="background-image: url('@fondo'); background-size: cover;">

<!-- INSTRUCCIONES (overlay) -->
<div id="overlay-instrucciones" class="overlay">
    <div class="contenido-instrucciones">
        <h2>¡Bienvenido a Sala 5!</h2>
        <p>Jugá al Wordle. Adiviná la palabra escondida. Cada intento te mostrará si las letras están en la posición correcta (verde), en otra posición (amarillo), o si no están (rojo). Cuando completes todos, usá las pistas para ordenar una palabra final.</p>
        <button onclick="iniciarJuego()">Jugar</button>
    </div>
</div>

<!-- CONTENEDOR PRINCIPAL DEL JUEGO -->
<div id="contenedor-wordle" style="display: none;">

    <p>@ViewBag.mensaje</p>

    @if (cantLetras > 0)
    {
        <p>La palabra tiene <b>@cantLetras</b> letras.</p>
    }

    @if (ViewBag.error != null)
    {
        <div style="color:red">@ViewBag.error</div>
    }

    <div style="display: flex; gap: 30px; margin-bottom: 20px;">
        @if (historial != null)
        {
            int num = 1;
            foreach (var wordle in historial)
            {
                <div>
                    <h4>Wordle @num</h4>
                    @foreach (var jugada in wordle.Jugadas)
                    {
                        <div>
                            @foreach (var letra in jugada)
                            {
                                var clase = letra.Color == 'v' ? "verde" :
                                            letra.Color == 'a' ? "amarillo" :
                                            "rojo";
                                <span class="@clase">@letra.Letra</span>
                            }
                        </div>
                    }
                </div>
                num++;
            }
        }
    </div>

    <div>
        @if (!finalizado)
        {
            <form action='@Url.Action("Sala5", "Home")' method="POST" class="form-wordle">
                <input type="text" name="wordle" pattern="[a-zA-Z]+" placeholder="Palabra" required autocomplete="off" maxlength="@cantLetras" minlength="@cantLetras">
                <button type="submit">Comprobar</button>
            </form>
        }
    </div>

    @if (finalizado)
    {
        <div id="submitCodigo">
            <form action='@Url.Action("Sala5", "Home")' method="POST">
                <input type="text" name="clave" placeholder="Ordená las pistas" required minlength="5" maxlength="5">
                <input type="submit" value="Guardar">
            </form>
        </div>
    }

</div>

<!-- SCRIPTS -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const yaVioInstrucciones = localStorage.getItem("sala5_vio_instrucciones");

        if (yaVioInstrucciones === "true") {
            document.getElementById("overlay-instrucciones").style.display = "none";
            document.getElementById("contenedor-wordle").style.display = "block";
        }
    });

    function iniciarJuego() {
        document.getElementById("overlay-instrucciones").style.display = "none";
        document.getElementById("contenedor-wordle").style.display = "block";
        localStorage.setItem("sala5_vio_instrucciones", "true");
    }
</script>

<!-- ESTILOS DEL OVERLAY -->
<style>
    .overlay {
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background-color: rgba(0, 0, 0, 0.9);
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        text-align: center;
        padding: 20px;
    }

    .contenido-instrucciones {
        max-width: 600px;
    }

    .contenido-instrucciones button {
        margin-top: 20px;
        padding: 12px 24px;
        font-size: 18px;
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
    }

    .contenido-instrucciones button:hover {
        background-color: #218838;
    }

    .verde {
        background-color: green;
        color: white;
        padding: 5px;
        margin: 1px;
        border-radius: 4px;
    }

    .amarillo {
        background-color: goldenrod;
        color: white;
        padding: 5px;
        margin: 1px;
        border-radius: 4px;
    }

    .rojo {
        background-color: darkred;
        color: white;
        padding: 5px;
        margin: 1px;
        border-radius: 4px;
    }
</style>

</body>
